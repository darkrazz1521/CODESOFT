<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories - Devyntra</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <header class="navbar">
        <div class="logo">Devyntra</div>
        <nav>
            <a href="index.html">Home</a>
            <a href="categories.html">Categories</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
        </nav>
        <div class="nav-actions">
            <a href="login.html" class="login-btn">Login</a>
        </div>
    </header>
    <main class="categories-listing">
        <div class="categories-header">
            <h1>Browse by Category</h1>
            <p class="categories-tagline">Find articles based on topics that interest you.</p>
        </div>
        <div class="category-cards-grid" id="categoryCards">
            <!-- Dynamic categories will be injected here -->
        </div>
        <section class="posts-grid" id="categoryPosts">
            <!-- Dynamic blog cards for a category -->
        </section>
        <div class="categories-cta">
            <a href="index.html" class="back-home-btn">‚Üê Back to Home</a>
        </div>
    </main>
    <script src="./js/auth-ui.js"></script>
    <!-- Mobile menu button and menu (only visible on mobile) -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" style="display:none;" aria-label="Open menu">
      <span class="bar bar1"></span>
      <span class="bar bar2"></span>
      <span class="bar bar3"></span>
    </button>
    <nav class="mobile-menu" id="mobileMenu" style="display:none;">
      <button class="close-btn" id="mobileMenuClose" aria-label="Close menu">&times;</button>
      <a href="write.html" id="mobileWriteBtn">Write Blog</a>
      <a href="dashboard.html" id="mobileDashboardBtn">Dashboard</a>
      <a href="#" id="mobileLogoutBtn">Logout</a>
    </nav>
    <script>
    async function fetchCategories() {
        const res = await fetch('https://devyntra-backend.onrender.com/api/categories');
        const cats = await res.json();
        const grid = document.getElementById('categoryCards');
        grid.innerHTML = '';
        cats.forEach(cat => {
            const card = document.createElement('a');
            card.className = 'category-card';
            card.href = "#";
            card.innerHTML = `<div class="category-icon">üìö</div>
                <div class="category-name">${cat}</div>
                <div class="category-count" id="count-${cat}"></div>`;
            card.onclick = (e) => {
                e.preventDefault();
                fetchBlogsByCategory(cat);
            };
            grid.appendChild(card);
        });
    }

    async function fetchBlogsByCategory(category) {
        const res = await fetch(`https://devyntra-backend.onrender.com/api/blogs?category=${encodeURIComponent(category)}&status=Published`);
        const blogs = await res.json();
        const postsGrid = document.getElementById('categoryPosts');
        postsGrid.innerHTML = '';
        if (!Array.isArray(blogs) || blogs.length === 0) {
            postsGrid.innerHTML = '<div style="color:var(--muted);text-align:center;">No posts found.</div>';
            return;
        }
        blogs.forEach(blog => {
            const card = document.createElement('article');
            card.className = 'post-card';
            card.innerHTML = `
                <img src="${blog.coverImage || 'https://via.placeholder.com/400x170?text=No+Image'}" alt="Post Thumbnail">
                <h3>${blog.title}</h3>
                <p>${blog.content ? blog.content.substring(0, 80) + '...' : ''}</p>
                <a href="post.html?id=${blog._id}" class="read-more">Read More</a>
            `;
            postsGrid.appendChild(card);
        });
        // Animate post cards after rendering
        animateCategoryCards();
    }

    // Animation for post cards in category view
    function animateCategoryCards() {
        const postCards = document.querySelectorAll("#categoryPosts .post-card");
        if (!postCards.length) return;
        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add("show");
                        } else {
                            entry.target.classList.remove("show");
                        }
                    });
                },
                { threshold: 0.2 }
            );
            postCards.forEach((card) => observer.observe(card));
        } else {
            postCards.forEach(card => card.classList.add('show'));
        }
    }

    // Mobile menu logic
    function showMobileMenuIfLoggedIn() {
      const user = localStorage.getItem('writelyUser');
      const btn = document.getElementById('mobileMenuBtn');
      const menu = document.getElementById('mobileMenu');
      if (window.innerWidth <= 500 && user) {
        btn.style.display = 'flex';
        menu.style.display = 'flex';
      } else {
        btn.style.display = 'none';
        menu.style.display = 'none';
      }
    }
    window.addEventListener('DOMContentLoaded', showMobileMenuIfLoggedIn);
    window.addEventListener('resize', showMobileMenuIfLoggedIn);

    // Hamburger open/close
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileMenuClose = document.getElementById('mobileMenuClose');
    if (mobileMenuBtn && mobileMenu && mobileMenuClose) {
      mobileMenuBtn.onclick = function() {
        mobileMenu.classList.toggle('open');
        mobileMenuBtn.classList.toggle('open');
      };
      mobileMenuClose.onclick = function() {
        mobileMenu.classList.remove('open');
        mobileMenuBtn.classList.remove('open');
      };
      // Close menu on navigation
      mobileMenu.querySelectorAll('a').forEach(a => {
        a.onclick = () => {
          mobileMenu.classList.remove('open');
          mobileMenuBtn.classList.remove('open');
        };
      });
      // Logout logic
      document.getElementById('mobileLogoutBtn').onclick = function(e) {
        e.preventDefault();
        localStorage.removeItem('writelyUser');
        localStorage.removeItem('token');
        window.location.reload();
      };
    }
    </script>
</body>
</html>
